{"version":3,"file":"static/chunks/pages/framebuffer-a5737ef09ff0fa17.js","mappings":"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","sources":["webpack://_N_E/?fc1a","webpack://_N_E/./src/pages/framebuffer.tsx"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/framebuffer\",\n      function () {\n        return require(\"private-next-pages/framebuffer.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/framebuffer\"])\n      });\n    }\n  ","import { ICommandBarItemProps, Stack } from '@fluentui/react';\nimport { AdbFrameBuffer } from \"@yume-chan/adb\";\nimport { action, autorun, computed, makeAutoObservable } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport Head from \"next/head\";\nimport { useCallback, useEffect, useRef } from 'react';\nimport { CommandBar, DemoModePanel, DeviceView } from '../components';\nimport { GlobalState } from \"../state\";\nimport { Icons, RouteStackProps } from \"../utils\";\n\nclass FrameBufferState {\n    width = 0;\n    height = 0;\n    imageData: ImageData | undefined = undefined;\n    demoModeVisible = false;\n\n    constructor() {\n        makeAutoObservable(this, {\n            toggleDemoModeVisible: action.bound,\n        });\n    }\n\n    setImage(image: AdbFrameBuffer) {\n        this.width = image.width;\n        this.height = image.height;\n        this.imageData = new ImageData(new Uint8ClampedArray(image.data), image.width, image.height);\n    }\n\n    toggleDemoModeVisible() {\n        this.demoModeVisible = !this.demoModeVisible;\n    }\n}\n\nconst state = new FrameBufferState();\n\nconst FrameBuffer: NextPage = (): JSX.Element | null => {\n    const canvasRef = useRef<HTMLCanvasElement | null>(null);\n\n    const capture = useCallback(async () => {\n        if (!GlobalState.device) {\n            return;\n        }\n\n        try {\n            const framebuffer = await GlobalState.device.framebuffer();\n            state.setImage(framebuffer);\n        } catch (e: any) {\n            GlobalState.showErrorDialog(e);\n        }\n    }, []);\n\n    useEffect(() => {\n        return autorun(() => {\n            const canvas = canvasRef.current;\n            if (canvas && state.imageData) {\n                canvas.width = state.width;\n                canvas.height = state.height;\n                const context = canvas.getContext(\"2d\")!;\n                context.putImageData(state.imageData, 0, 0);\n            }\n        });\n    }, []);\n\n    const commandBarItems = computed(() => [\n        {\n            key: 'start',\n            disabled: !GlobalState.device,\n            iconProps: { iconName: Icons.Camera, style: { height: 20, fontSize: 20, lineHeight: 1.5 } },\n            text: 'Capture',\n            onClick: capture,\n        },\n        {\n            key: 'Save',\n            disabled: !state.imageData,\n            iconProps: { iconName: Icons.Save, style: { height: 20, fontSize: 20, lineHeight: 1.5 } },\n            text: 'Save',\n            onClick: () => {\n                const canvas = canvasRef.current;\n                if (!canvas) {\n                    return;\n                }\n\n                const url = canvas.toDataURL();\n                const a = document.createElement('a');\n                a.href = url;\n                a.download = `Screenshot of ${GlobalState.backend!.name}.png`;\n                a.click();\n            },\n        },\n    ]);\n\n    const commandBarFarItems = computed((): ICommandBarItemProps[] => [\n        {\n            key: 'DemoMode',\n            iconProps: { iconName: Icons.Wand, style: { height: 20, fontSize: 20, lineHeight: 1.5 } },\n            checked: state.demoModeVisible,\n            text: 'Demo Mode',\n            onClick: state.toggleDemoModeVisible,\n        },\n        {\n            key: 'info',\n            iconProps: { iconName: Icons.Info, style: { height: 20, fontSize: 20, lineHeight: 1.5 } },\n            iconOnly: true,\n            tooltipHostProps: {\n                content: 'Use ADB FrameBuffer command to capture a full-size, high-resolution screenshot.',\n                calloutProps: {\n                    calloutMaxWidth: 250,\n                }\n            },\n        }\n    ]);\n\n    return (\n        <Stack {...RouteStackProps}>\n            <Head>\n                <title>Screen Capture - Android Web Toolbox</title>\n            </Head>\n\n            <CommandBar items={commandBarItems.get()} farItems={commandBarFarItems.get()} />\n            <Stack horizontal grow styles={{ root: { height: 0 } }}>\n                <DeviceView width={state.width} height={state.height}>\n                    <canvas ref={canvasRef} style={{ display: 'block' }} />\n                </DeviceView>\n\n                <DemoModePanel style={{ display: state.demoModeVisible ? 'block' : 'none' }} />\n            </Stack>\n        </Stack>\n    );\n};\n\nexport default observer(FrameBuffer);\n"],"names":["window","__NEXT_P","push","state","FrameBufferState","width","height","imageData","undefined","demoModeVisible","makeAutoObservable","this","toggleDemoModeVisible","action","setImage","image","ImageData","Uint8ClampedArray","data","observer","canvasRef","useRef","capture","useCallback","framebuffer","GlobalState","useEffect","autorun","canvas","current","getContext","putImageData","commandBarItems","computed","key","disabled","iconProps","iconName","Icons","style","fontSize","lineHeight","text","onClick","url","toDataURL","a","document","createElement","href","download","click","commandBarFarItems","checked","iconOnly","tooltipHostProps","content","calloutProps","calloutMaxWidth","Stack","RouteStackProps","Head","title","CommandBar","items","get","farItems","horizontal","grow","styles","root","DeviceView","ref","display","DemoModePanel"],"sourceRoot":""}